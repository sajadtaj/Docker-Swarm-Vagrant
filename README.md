<div dir='rtl'>

# Docker Swarm Consept

## ๐ ููุฏูู

ุงู ุจุฎุด ุจู ูุนุฑู ููุงูู ฺฉูุฏ **ูุฏุฑุช ฺฉูุงุณุชุฑ (Cluster Management)** ู **ุงุฑฺฉุณุชุฑุดู (Orchestration)** ุฏุฑ **Docker Engine 1.12** ูโูพุฑุฏุงุฒุฏ. ุงู ูุงุจูุชโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ **Swarmkit** ูพุงุฏูโุณุงุฒ ุดุฏูโุงูุฏ. **Swarmkit** ฺฉ ูพุฑูฺู ูุณุชูู ุงุณุช ฺฉู ูุงู ุงุฑฺฉุณุชุฑุดู Docker ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ ู ูุณุชููุงู ุฏุฑ Docker ุงุณุชูุงุฏู ูโุดูุฏ.

---

## ๐ณ Swarm ฺุณุชุ

ฺฉ **Swarm** ูุฌููุนูโุง ุงุฒ ฺูุฏู **Docker Host** ุงุณุช ฺฉู ุฏุฑ ุญุงูุช **Swarm Mode** ุงุฌุฑุง ูโุดููุฏ ู ูโุชูุงููุฏ ุฏู ููุด ุงูุง ฺฉููุฏ:

1. **ูุฏุฑ (Manager)** โ ูุฏุฑุช ุนุถูุชุ ููุงููฺฏ ู ุชูุฒุน ูุธุงู.
2. **ฺฉุงุฑฺฏุฑ (Worker)** โ ุงุฌุฑุง ุณุฑูุณโูุง Swarm.

ฺฉ **Docker Host** ูโุชูุงูุฏ:

* ููุท **Manager** ุจุงุดุฏุ
* ููุท **Worker** ุจุงุดุฏุ
* ุง ูุฑ ุฏู ููุด ุฑุง ููโุฒูุงู ุฏุงุดุชู ุจุงุดุฏ.

### ๐น ูุซุงู ูุงูุน:

ูุฑุถ ฺฉูุฏ ฺฉ ูุฑูุดฺฏุงู ุขููุงู ุฏุงุฑุฏ ฺฉู ุจุงุฏ ููุดู ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ. ุดูุง ต ุณุฑูุฑ ุฏุงุฑุฏ:

* ฒ ุณุฑูุฑ ุจู ุนููุงู **Manager** ุจุฑุง ฺฉูุชุฑู ู ููุงููฺฏ.
* ณ ุณุฑูุฑ ุจู ุนููุงู **Worker** ุจุฑุง ุงุฌุฑุง ุฏุฑุฎูุงุณุชโูุง ู ูพุฑุฏุงุฒุด ุณูุงุฑุดุงุช.

ุงฺฏุฑ ฺฉ ุงุฒ Workerูุง ุงุฒ ฺฉุงุฑ ุจูุชุฏุ Swarm ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูุธุงู ุขู ุฑุง ุจู ุฏฺฏุฑ Workerูุง ููุชูู ูโฺฉูุฏ.

---

## ๐ฏ Desired State (ูุถุนุช ูุทููุจ)

ููุช ฺฉ ุณุฑูุณ ุงุฌุงุฏ ูโฺฉูุฏุ ููุงุฑุฏ ูุงููุฏ:

* ุชุนุฏุงุฏ Replicaูุงุ
* ููุงุจุน ุดุจฺฉู ู ุฐุฎุฑูโุณุงุฒุ
* ูพูุฑุชโูุง ุจุงุฒ ุจู ุจุฑููุ
* ู ุณุงุฑ ุชูุธูุงุช

ุฑุง ูุดุฎุต ูโฺฉูุฏ. Swarm ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุงุด ูโฺฉูุฏ ุงู **ูุถุนุช ูุทููุจ** ุฑุง ุญูุธ ฺฉูุฏ.

> ุชูุงูุช ฺฉูุฏ ุณุฑูุณโูุง Swarm ุจุง ฺฉุงูุชูุฑูุง ุชฺฉ (**Standalone Containers**) ุงู ุงุณุช ฺฉู ูโุชูุงูุฏ **ุชูุธูุงุช ุณุฑูุณ** (ูุงููุฏ ุดุจฺฉู ุง Volume) ุฑุง ุชุบุฑ ุฏูุฏ ุจุฏูู ุงูฺฉู ูุงุฒ ุจุงุดุฏ ุณุฑูุณ ุฑุง ุฏุณุช ุฑุณุชุงุฑุช ฺฉูุฏ.

---

## ๐ฅ Nodes (ููุฏูุง)

ฺฉ **Node** ููุงู ูููููโุง ุงุฒ Docker Engine ุงุณุช ฺฉู ุฏุฑ Swarm ุดุฑฺฉุช ุฏุงุฑุฏ.

* **Manager Node** โ ูุธุงู ุงุฑฺฉุณุชุฑุดู ู ูุฏุฑุช ฺฉูุงุณุชุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ ู ฺฉ **Leader** ุงูุชุฎุงุจ ูโฺฉูุฏ.
* **Worker Node** โ ูุธุงู ฺฉู ุงุฒ Manager ุฏุฑุงูุช ฺฉุฑุฏู ุงุฌุฑุง ูโฺฉูุฏ.

๐น **ูุซุงู ูุงูุน:**
ุฏุฑ ฺฉ ุงุณุชุงุฑุชุงูพ SaaSุ ููฺฉู ุงุณุช ููุฏูุง Worker ุฑู AWS EC2 ุจุงุดูุฏ ู ููุฏูุง Manager ุฑู ุณุฑูุฑูุง ูุฒฺฉ ูุญู ุจุฑุง ุงููุช ุจุดุชุฑ ูฺฏูุฏุงุฑ ุดููุฏ.

---

## โ Services ู Tasks

* **Service** โ ุชุนุฑู ูุธุงู ฺฉู ุจุงุฏ ุฑู Manager ุง Worker ุงุฌุฑุง ุดููุฏ.
* **Task** โ ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ุฒูุงูโุจูุฏ ุฏุฑ Swarm ฺฉู ุดุงูู ฺฉ ฺฉุงูุชูุฑ ู ุฏุณุชูุฑ ุงุฌุฑุง ุขู ุงุณุช.

ุฏู ูุฏู ุณุฑูุณ:

1. **Replicated Services** โ ูุซูุงู ต Replica ุงุฒ ฺฉ API ุฏุฑ ููุฏูุง ูุฎุชูู.
2. **Global Services** โ ุงุฌุฑุง ฺฉ ูุณุฎู ุงุฒ ุณุฑูุณ ุฑู ุชูุงู ููุฏูุง ููุฌูุฏ (ูุซู ฺฉ Agent ูุงูุชูุฑูฺฏ).

๐น **ูุซุงู ูุงูุน:**

* ุณุฑูุณ **Nginx** ุจู ุตูุฑุช **Replicated** ุจุง ด Replica.
* ุณุฑูุณ **Node Exporter** ุจุฑุง ูุงูุชูุฑูฺฏ ุจู ุตูุฑุช **Global** ุฑู ููู ููุฏูุง.

---

## ๐ Load Balancing (ุจุงูุงูุณ ุจุงุฑ)

Swarm ุฏู ููุน Load Balancing ุฏุงุฑุฏ:

1. **Ingress Load Balancing (ุจุฑูู)**

   * ุงุฎุชุตุงุต ูพูุฑุช ููุชุดุฑุดุฏู (Published Port) ุจู 30000โ32767 ุจู ุณุฑูุณ.
   * ุฏุฑุฎูุงุณุชโูุง ูุฑูุฏ ุจู ูุฑ ููุฏ ุจู ุณุฑูุณ ูุฑุจูุทู ูุฏุงุช ูโุดููุฏ.

2. **Internal Load Balancing (ุฏุงุฎู)**

   * ูุฑ ุณุฑูุณ ฺฉ ุฑฺฉูุฑุฏ DNS ุฏุงุฎู ุฏุงุฑุฏ.
   * ุฏุฑุฎูุงุณุชโูุง ุฏุงุฎู ฺฉูุงุณุชุฑ ุจุฑ ุงุณุงุณ ูุงู DNS ุจู Taskูุง ุชูุฒุน ูโุดููุฏ.

๐น **ูุซุงู ูุงูุน:**
ฺฉุงุฑุจุฑ ุฏุฑ ุขููุงู ุจู ุขุฏุฑุณ `myshop.com` ูุตู ูโุดูุฏุ ุฏุฑุฎูุงุณุช ุงู ุจู ูุฒุฏฺฉโุชุฑู ููุฏ Worker ูโุฑูุฏ ู Swarm ุขู ุฑุง ุจู ฺฉ ุงุฒ Replicaูุง ูุฏุงุช ูโฺฉูุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ูุนูุงุฑ Docker Swarm

```mermaid
graph TD
    A[Client Request] --> B[Ingress Load Balancer]
    B --> C1[Manager Node]
    B --> C2[Worker Node 1]
    B --> C3[Worker Node 2]
    
    C1 -->|Orchestration| D1[Task 1 - Service API]
    C2 -->|Executes Task| D2[Task 2 - Service API]
    C3 -->|Executes Task| D3[Task 3 - Service API]
    
    subgraph Managers
        C1
    end
    
    subgraph Workers
        C2
        C3
    end
```

---

## ๐ ุฌูุนโุจูุฏ

| ููููู              | ุชูุถุญ                                        | ูุซุงู ูุงูุน                      |
| ------------------ | -------------------------------------------- | ------------------------------- |
| **Swarm**          | ุฎูุดูโุง ุงุฒ Docker Hostูุง ุจุฑุง ุงุฌุฑุง ุณุฑูุณโูุง | ูุจโุณุงุช ูุฑูุด ุขููุงู ฺูุฏุณุฑูุณ   |
| **Manager Node**   | ููุงููฺฏโฺฉููุฏู ูุธุงู ู ุญูุธ ูุถุนุช ูุทููุจ         | ฺฉูุชุฑู Replicaูุง ู Load Balancer |
| **Worker Node**    | ุงุฌุฑุง ูุธุงู ุฏุฑุงูุช ุงุฒ Manager               | ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช ฺฉุงุฑุจุฑุงู          |
| **Service**        | ุชุนุฑู ูุธุงู ู ฺฉุงูุชูุฑูุง                      | ุณุฑูุณ API ูุญุตูู                 |
| **Task**           | ูุงุญุฏ ุงุฌุฑุง ุดุงูู ฺฉ ฺฉุงูุชูุฑ                  | ุงุฌุฑุง ฺฉ Replica ุงุฒ API         |
| **Load Balancing** | ุชูุฒุน ุฏุฑุฎูุงุณุชโูุง ุจู ููุฏูุง                   | ุชูุณู ุฏุฑุฎูุงุณุชโูุง ุจู ด ุณุฑูุฑ API |

---
# Swarm mode


## ๐ ูุนุฑู

ูุณุฎูโูุง ูุนู **Docker** ุดุงูู **ุญุงูุช Swarm** ูุณุชูุฏ ฺฉู ุงูฺฉุงู ูุฏุฑุช ุจูู ฺฉ ฺฉูุงุณุชุฑ ุงุฒ Docker Engineโูุง ุฑุง ูุฑุงูู ูโฺฉููุฏ (ฺฉู ุจู ุขู **Swarm** ฺฏูุชู ูโุดูุฏ).
ุจุง ุงุณุชูุงุฏู ุงุฒ **Docker CLI** ูโุชูุงูุฏ:

* ฺฉ Swarm ุงุฌุงุฏ ฺฉูุฏ.
* ุณุฑูุณโูุง ุจุฑูุงูู ุฑุง ุฑู Swarm ูุณุชูุฑ ฺฉูุฏ.
* ุฑูุชุงุฑ Swarm ุฑุง ูุฏุฑุช ฺฉูุฏ.

> **ูฺฉุชู ููู:** ุญุงูุช ุฌุฏุฏ **Docker Swarm mode** ุฏุงุฎู Docker Engine ุชุนุจู ุดุฏู ุงุณุช ู ูุจุงุฏ ุจุง **Docker Classic Swarm** (ฺฉู ุฏฺฏุฑ ุชูุณุนู ุฏุงุฏู ููโุดูุฏ) ุงุดุชุจุงู ฺฏุฑูุชู ุดูุฏ.

---

## โจ ูฺฺฏโูุง ฺฉูุฏ

### 1. **ูุฏุฑุช ฺฉูุงุณุชุฑ ฺฉูพุงุฑฺู ุจุง Docker Engine**

* ุจุง ุงุณุชูุงุฏู ุงุฒ **Docker Engine CLI** ูโุชูุงูุฏ ฺฉ ฺฉูุงุณุชุฑ Swarm ุจุณุงุฒุฏ ู ุณุฑูุณโูุง ุฑุง ูุณุชูุฑ ฺฉูุฏ.
* ูุงุฒ ุจู ูุฑูโุงูุฒุงุฑ ุงุฑฺฉุณุชุฑุดู ุฌุฏุงฺฏุงูู ูุฏุงุฑุฏ.

๐น **ูุซุงู ูุงูุน:**
ฺฉ ุดุฑฺฉุช SaaS ุจุง ุณู ุณุฑูุฑ ูโุชูุงูุฏ ููุท ุจุง Docker Engineุ ฺฉูุงุณุชุฑ Swarm ุฎูุฏ ุฑุง ุจุงูุง ุจุงูุฑุฏ ู ุณุฑูุณโูุง ูุจุ ูพุงฺฏุงู ุฏุงุฏู ู ูพุฑุฏุงุฒุด ูพุงู ุฑุง ูุฏุฑุช ฺฉูุฏ.

---

### 2. **ุทุฑุงุญ ุบุฑูุชูุฑฺฉุฒ (Decentralized Design)**

* ูุงุฒ ุจู ุชุนู ููุด ููุฏูุง ุฏุฑ ุฒูุงู ุงุณุชูุฑุงุฑ ูุณุชุ Docker Engine ุงู ููุดโูุง ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ูุดุฎุต ูโฺฉูุฏ.
* ุงุฒ ฺฉ **ุงูุฌ ุฏุณฺฉ ูุงุญุฏ** ูโุชูุงูุฏ ูู ููุฏูุง Manager ู ูู Worker ุจุณุงุฒุฏ.

๐น **ูุซุงู:**
ุชุตูุฑ ฺฉูุฏ ุจุฑุง ุชูุณุนู ู ุชุณุชุ ููู ููุฏูุง ุงุฒ ฺฉ Snapshot ุณุฑูุฑ ุณุงุฎุชู ุดุฏูโุงูุฏ ู ููุด ุขูโูุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ุชุนู ูโุดูุฏ.

---

### 3. **ูุฏู ุณุฑูุณ ุงุนูุงู (Declarative Service Model)**

* ูุถุนุช ูุทููุจ (Desired State) ุณุฑูุณโูุง ุฑุง ุชุนุฑู ูโฺฉูุฏ.
* ูุซุงู: ฺฉ ุงูพูฺฉุดู ุดุงูู ุณุฑูุณ Frontend ูุจุ ุณุฑูุณ ุตู ูพุงู (Message Queue)ุ ู Backend ูพุงฺฏุงู ุฏุงุฏู.

---

### 4. **ููุงุณโูพุฐุฑ (Scaling)**

* ุชุนุฏุงุฏ **Task**โูุง ูุฑ ุณุฑูุณ ุฑุง ูุดุฎุต ูโฺฉูุฏ.
* ุฏุฑ ุฒูุงู ุงูุฒุงุด ุง ฺฉุงูุด ููุงุณุ Swarm Manager ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ Taskูุง ุฑุง ุงุถุงูู ุง ุญุฐู ูโฺฉูุฏ.

๐น **ูุซุงู:**
ฺฉ ุณุฑูุณ API ุงุฒ ณ Replica ุจู ถ Replica ุงูุฒุงุด ูโุงุจุฏ ุชุง ุชุฑุงูฺฉ ุจุดุชุฑ ุฑุง ูพุงุณุฎ ุฏูุฏ.

---

### 5. **ุชุทุจู ูุถุนุช ูุทููุจ (Desired State Reconciliation)**

* Manager ููุดู ูุถุนุช ูุงูุน ฺฉูุงุณุชุฑ ุฑุง ุจุง ูุถุนุช ูุทููุจ ููุงุณู ูโฺฉูุฏ.
* ุงฺฏุฑ ููุฏ ฺฉู ุจุฎุด ุงุฒ Replicaูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ ุงุฒ ฺฉุงุฑ ุจูุชุฏุ Manager ูุณุฎูโูุง ุฌุงฺฏุฒู ุฑุง ุฑู ููุฏูุง ุณุงูู ุงุฌุงุฏ ูโฺฉูุฏ.

---

### 6. **ุดุจฺฉู ฺูุฏโูุฒุจุงูู (Multi-host Networking)**

* ูโุชูุงูุฏ ฺฉ **Overlay Network** ุจุฑุง ุณุฑูุณโูุง ุชุนู ฺฉูุฏ.
* Swarm Manager ุจู ฺฉุงูุชูุฑูุง ุขุฏุฑุณ IP ุฏุฑ ุงู ุดุจฺฉู ุงุฎุชุตุงุต ูโุฏูุฏ.

---

### 7. **ฺฉุดู ุณุฑูุณ (Service Discovery)**

* ูุฑ ุณุฑูุณ ฺฉ ูุงู DNS ููุญุตุฑุจูโูุฑุฏ ุฏุฑุงูุช ูโฺฉูุฏ.
* Load Balancing ุฏุงุฎู ุจุฑ ุงุณุงุณ ูุงู DNS ุณุฑูุณ ุงูุฌุงู ูโุดูุฏ.

---

### 8. **ุจุงูุงูุณ ุจุงุฑ (Load Balancing)**

* ูโุชูุงูุฏ ูพูุฑุช ุณุฑูุณโูุง ุฑุง ุจู ฺฉ Load Balancer ุฎุงุฑุฌ ูุนุฑู ฺฉูุฏ.
* ุจูโุตูุฑุช ุฏุงุฎูุ Swarm ูุญูู ุชูุฒุน ฺฉุงูุชูุฑูุง ุณุฑูุณ ุจู ููุฏูุง ุฑุง ฺฉูุชุฑู ูโฺฉูุฏ.

---

### 9. **ุงููุช ูพุดโูุฑุถ (Secure by Default)**

* ููู ููุฏูุง ุงุฒ TLS Mutual Authentication ู ุฑูุฒูฺฏุงุฑ ุจุฑุง ุงุฑุชุจุงุทุงุช ุงุณุชูุงุฏู ูโฺฉููุฏ.
* ุงูฺฉุงู ุงุณุชูุงุฏู ุงุฒ **Self-signed Certificate** ุง **Custom Root CA** ูุฌูุฏ ุฏุงุฑุฏ.

---

### 10. **ุจูโุฑูุฒุฑุณุงู ุชุฏุฑุฌ (Rolling Updates)**

* ุจูโุฑูุฒุฑุณุงู ุณุฑูุณโูุง ุจูโุตูุฑุช ุชุฏุฑุฌ ุฑู ููุฏูุง ุงุนูุงู ูโุดูุฏ.
* ุงูฺฉุงู **Rollback** ุจู ูุณุฎู ูุจู ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู ูุฌูุฏ ุฏุงุฑุฏ.

๐น **ูุซุงู:**
ุขูพุฏุช ุชุฏุฑุฌ ูุณุฎู ุฌุฏุฏ Backend ุฑู ฒฐูช ููุฏูุงุ ุจุฑุฑุณ ุนููฺฉุฑุฏุ ู ุณูพุณ ุงุฏุงูู ุงูุชุดุงุฑ ุฑู ุจุงู ููุฏูุง.

---

## ๐ ูููุฏุงุฑ Mermaid โ ูุนูุงุฑ ู ูฺฺฏโูุง Swarm Mode

```mermaid
graph LR
    subgraph Swarm Cluster
        M1[Manager Node 1]:::manager
        M2[Manager Node 2]:::manager
        W1[Worker Node 1]:::worker
        W2[Worker Node 2]:::worker
        W3[Worker Node 3]:::worker
    end
    
    M1 -->|Orchestration| W1
    M1 -->|Orchestration| W2
    M1 -->|Orchestration| W3
    
    subgraph Features
        A[Cluster Management]
        B[Declarative Services]
        C[Scaling]
        D[Load Balancing]
        E[Rolling Updates]
        F[Secure by Default]
    end
    
    M1 --> A
    M1 --> B
    M1 --> C
    M1 --> D
    M1 --> E
    M1 --> F

    %% class manager fill=#4DB6AC,stroke=#00695C,color=white;
    %% class worker fill=#81C784,stroke=#1B5E20,color=white;
```

---

## ๐ ุฌูุนโุจูุฏ ูฺฺฏโูุง

| ูฺฺฏ                            | ุชูุถุญ                                   | ูุซุงู ูุงูุน                              |
| -------------------------------- | --------------------------------------- | --------------------------------------- |
| **Cluster Management**           | ุณุงุฎุช ู ูุฏุฑุช ฺฉูุงุณุชุฑ ุฏุงุฎู Docker Engine | ฺฉูุงุณุชุฑ ต ููุฏ ุจุฑุง ุณุฑูุณ ูุฑูุดฺฏุงู        |
| **Decentralized Design**         | ููุด ููุฏูุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ุชุนู ูโุดูุฏ     | ุงุณุชูุงุฏู ุงุฒ ฺฉ ุงูุฌ ูุงุญุฏ ุจุฑุง ููู ููุฏูุง |
| **Declarative Model**            | ุชุนุฑู ูุถุนุช ูุทููุจ ุณุฑูุณโูุง              | ุณุฑูุณ ูุจ + ุตู ูพุงู + ูพุงฺฏุงู ุฏุงุฏู        |
| **Scaling**                      | ุงูุฒุงุด ุง ฺฉุงูุด ุชุนุฏุงุฏ Taskูุง             | ุงูุฒุงุด Replica ุงุฒ ณ ุจู ถ                |
| **Desired State Reconciliation** | ุฌุงฺฏุฒู ุฎูุฏฺฉุงุฑ Taskูุง ูพุณ ุงุฒ ุฎุฑุงุจ      | ุงุฌุงุฏ ฒ Replica ุฌุงฺฏุฒู ูพุณ ุงุฒ Crash     |
| **Multi-host Networking**        | ุดุจฺฉู Overlay ุจู ฺูุฏ ุณุฑูุฑ               | ุงุฑุชุจุงุท ุณุฑูุณโูุง ุฏุฑ ุฏุชุงุณูุชุฑ ู Cloud     |
| **Service Discovery**            | ุชุฎุตุต DNS ุฏุงุฎู ู Load Balancing        | `api_service` ูุงุจู ุฏุณุชุฑุณ ุจุง DNS ุฏุงุฎู  |
| **Load Balancing**               | ุชูุฒุน ุฏุฑุฎูุงุณุชโูุง ุจู ููุฏูุง              | ุงุณุชูุงุฏู ุงุฒ Nginx ุง HAProxy ุฎุงุฑุฌ       |
| **Secure by Default**            | ุงุฑุชุจุงุท ุงูู ุจุง TLS                       | ุชุจุงุฏู ุงูู ุฏุงุฏู ุจู ููุฏูุง AWS           |
| **Rolling Updates**              | ุงูุชุดุงุฑ ุชุฏุฑุฌ ุขูพุฏุช                     | ุขูพุฏุช ูุณุฎู ุฌุฏุฏ ุจุฏูู Downtime           |

---

# Getting started with Swarm mode

## ๐ ุดุฑูุน ฺฉุงุฑ ุจุง ุญุงูุช Swarm ุฏุฑ Docker

ุงู ุขููุฒุด ุดูุง ุฑุง ุจุง ูุงุจูุชโูุง ุญุงูุช **Swarm Mode** ุฏุฑ **Docker Engine** ุขุดูุง ูโฺฉูุฏ.
ูพุดููุงุฏ ูโุดูุฏ ูุจู ุงุฒ ุดุฑูุนุ ุจุง **[ููุงูู ฺฉูุฏ](../key-concepts.md)** ุขุดูุง ุดูุฏ.

ุงู ุขููุฒุด ุดุงูู ูุฑุงุญู ุฒุฑ ุงุณุช:

1. **ุฑุงูโุงูุฏุงุฒ ฺฉ ฺฉูุงุณุชุฑ ุงุฒ Docker Engineโูุง ุฏุฑ ุญุงูุช Swarm**
2. **ุงุถุงูู ฺฉุฑุฏู ููุฏูุง ุจู Swarm**
3. **ุงุณุชูุฑุงุฑ ุณุฑูุณโูุง ุจุฑูุงูู ุฑู Swarm**
4. **ูุฏุฑุช Swarm ูพุณ ุงุฒ ุฑุงูโุงูุฏุงุฒ**

> ุงู ูุฑุงุญู ุจุง ุงุณุชูุงุฏู ุงุฒ **ุฏุณุชูุฑุงุช CLI ุฏุฑ Docker** ู ุงุฌุฑุง ุขูโูุง ุฏุฑ ุชุฑููุงู ุงูุฌุงู ูโุดูุฏ.
> ุงฺฏุฑ ุชุงุฒูโฺฉุงุฑ ูุณุชุฏุ ุงุจุชุฏุง [About Docker Engine](../../_index.md) ุฑุง ูุทุงูุนู ฺฉูุฏ.

---

## ๐ ูพุดโูุงุฒูุง

ุจุฑุง ุงุฌุฑุง ุงู ุขููุฒุด ุจู ููุงุฑุฏ ุฒุฑ ูุงุฒ ุฏุงุฑุฏ:

* **ุณู ูุงุดู ูููฺฉุณ** ฺฉู ุฑู ุขูโูุง Docker ูุตุจ ุจุงุดุฏ ู ุจุชูุงููุฏ ุงุฒ ุทุฑู ุดุจฺฉู ุจุง ูู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉููุฏ.
* **ุขุฏุฑุณ IP ูุงุดู Manager**
* **ุจุงุฒ ุจูุฏู ูพูุฑุชโูุง ูุดุฎุต ุจู ูุงุดูโูุง**

---

### 1. ุณู ูุงุดู ูุฒุจุงู ุดุจฺฉูโุดุฏู (Three Networked Host Machines)

* ูโุชูุงูุฏ ูุงุดู ูุฒฺฉุ ูุงุดู ูุฌุงุฒุ **Amazon EC2 Instance** ุง ูุฑ ุณุฑูุณ ุฏฺฏุฑ ุจุงุดุฏ.
* ฺฉ ุงุฒ ุงู ูุงุดูโูุง ููุด **Manager** ุฏุงุฑุฏ (ุจุง ูุงู `manager1`) ู ุฏู ูุงุดู ุฏฺฏุฑ ููุด **Worker** (`worker1` ู `worker2`).

> ๐ก **ูฺฉุชู:** ูโุชูุงูุฏ ุจุณุงุฑ ุงุฒ ูุฑุงุญู ุฑุง ุญุช ุจุง ฺฉ ููุฏ ุงูุฌุงู ุฏูุฏ (Single-node swarm)ุ ูู ุฏุณุชูุฑุงุช ูุฑุจูุท ุจู ฺูุฏ ููุฏ ฺฉุงุฑ ูุฎูุงููุฏ ฺฉุฑุฏ.

---

#### ูุตุจ Docker Engine ุฑู ูุงุดูโูุง ูููฺฉุณ

ุงฺฏุฑ ุงุฒ ูุงุดูโูุง ูููฺฉุณ (ูุฒฺฉ ุง ุงุจุฑ) ุงุณุชูุงุฏู ูโฺฉูุฏ:

* ุฏุณุชูุฑุงูุนูู ูุตุจ ูููฺฉุณ ุฑุง ุฏุฑ [ุตูุญู ูุตุจ Docker](../../install/_index.md) ุฏูุจุงู ฺฉูุฏ.
* ูพุณ ุงุฒ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ ณ ูุงุดูุ ุขูุงุฏู ฺฉุงุฑ ูุณุชุฏ.
* ูโุชูุงูุฏ ุณูุงุฑููุง **ฺฉโููุฏ** ู **ฺูุฏููุฏ** ุฑุง ุขุฒูุงุด ฺฉูุฏ.

---

### 2. ุขุฏุฑุณ IP ูุงุดู Manager

* ุจุงุฏ ุจู ฺฉ **ุฑุงุจุท ุดุจฺฉู (Network Interface)** ูุนุชุจุฑ ุฏุฑ ุณุณุชูโุนุงูู ุงุฎุชุตุงุต ุฏุงุฏู ุดุฏู ุจุงุดุฏ.
* ููู ููุฏูุง ุจุงุฏ ุจู ุงู IP ูุตู ุดููุฏ.
* ุชูุตู ูโุดูุฏ ุงุฒ ฺฉ **IP ุซุงุจุช (Static IP)** ุงุณุชูุงุฏู ฺฉูุฏ.

๐น **ูุซุงู:** ุฏุฑ ุงู ุขููุฒุดุ `manager1` ุฏุงุฑุง IP ุฒุฑ ุงุณุช:

```
192.168.99.100
```

ุจุฑุง ูุดุงูุฏู IP:

```bash
ifconfig
```

---

### 3. ุจุงุฒ ุจูุฏู ูพุฑูุชฺฉูโูุง ู ูพูุฑุชโูุง ุจู ูุฒุจุงูโูุง

ูพูุฑุชโูุง ููุฑุฏูุงุฒ (ุฏุฑ ุจุฑุฎ ุณุณุชูโูุง ุจูโุตูุฑุช ูพุดโูุฑุถ ุจุงุฒ ูุณุชูุฏ):

| ูพูุฑุช / ูพุฑูุชฺฉู   | ฺฉุงุฑุจุฑุฏ                      |
| --------------- | --------------------------- |
| `2377/TCP`      | ุงุฑุชุจุงุท ุจู ููุฏูุง Manager   |
| `7946/TCP, UDP` | ฺฉุดู ููุฏูุง ุฏุฑ ุดุจฺฉู Overlay   |
| `4789/UDP`      | ุชุฑุงูฺฉ ุดุจฺฉู Overlay (VXLAN) |

> ุงฺฏุฑ ุงุฒ ุดุจฺฉู Overlay ุจุง ุฑูุฒฺฏุฐุงุฑ (`--opt encrypted`) ุงุณุชูุงุฏู ูโฺฉูุฏุ ุจุงุฏ **ูพุฑูุชฺฉู IP ุดูุงุฑู 50 (IPSec ESP)** ูุฒ ุจุงุฒ ุจุงุดุฏ.

---

### ูฺฉุงุช ุงููุช ูพูุฑุช 4789 (VXLAN)

* ุงู ูพูุฑุช ุจุงุฏ ููุท ุจู **ุดุจฺฉูโูุง ููุฑุฏ ุงุนุชูุงุฏ** ุจุงุฒ ุจุงุดุฏ.
* ูุฑฺฏุฒ ุขู ุฑุง ุฏุฑ **Firewall ูุญุท ูุฑุฒ (Perimeter Firewall)** ุจู ุฑู ุงูุชุฑูุช ุจุงุฒ ูฺฉูุฏ.
* ุจุฑุง ุงููุช ุจุดุชุฑ ุฏุฑ ุดุจฺฉูโูุง ุบุฑูุงุจู ุงุนุชูุงุฏ:

  * **ุดุจฺฉู Ingress ูพุดโูุฑุถ** ุฑุง ุณูุงุฑุดโุณุงุฒ ู ุฑูุฒฺฏุฐุงุฑ ฺฉูุฏ.
  * ุชููุง ุจุณุชูโูุง ุฑูุฒฺฏุฐุงุฑโุดุฏู ุฑุง ุฑู ูพูุฑุช Data Path ุจูพุฐุฑุฏ.

ููููู ูุงููู **iptables**:

```bash
iptables -I INPUT -m udp --dport 4789 -m policy --dir in --pol none -j DROP
```

---

## ๐ ูููุฏุงุฑ Mermaid โ ุชููพูููฺ Swarm

```mermaid
graph TD
    A[Manager Node: 192.168.99.100] -->|Port 2377| B[Worker Node 1]
    A -->|Port 2377| C[Worker Node 2]
    A -->|Overlay Network Port 7946 TCP/UDP, 4789 UDP| B
    A -->|Overlay Network Port 7946 TCP/UDP, 4789 UDP| C
    B <--> C
    %% classDef manager fill=#4DB6AC,stroke=#00695C,color=white;
    %% classDef worker fill=#81C784,stroke=#1B5E20,color=white;
    class A manager;
    class B worker;
    class C worker;
```

---

## ๐ ูุซุงู ูุงูุน

ุณูุงุฑู ุฑุงูโุงูุฏุงุฒ ฺฉ Swarm ุณูโููุฏ ุฑู **ุณู ูุงุดู ูุฌุงุฒ Ubuntu** ุฏุฑ ฺฉ ุฏุชุงุณูุชุฑ ุฎุตูุต:

1. ุฑู `manager1`:

```bash
docker swarm init --advertise-addr 192.168.99.100
```

2. ุฎุฑูุฌ ุฏุณุชูุฑ ุจุงูุง ุดุงูู ฺฉ **ุชูฺฉู Join** ุจุฑุง Workerูุง ุงุณุช. ุฑู ูุฑ Worker ุงุฌุฑุง ฺฉูุฏ:

```bash
docker swarm join --token <token> 192.168.99.100:2377
```

3. ุจุฑุฑุณ ูุถุนุช ููุฏูุง:

```bash
docker node ls
```

# Create a swarm


## ๐ ุงุฌุงุฏ ฺฉ Swarm ุฏุฑ Docker

ูพุณ ุงุฒ ุงุชูุงู ูุฑุงุญู [ุชูุธูุงุช ุงููู](index.md)ุ ูโุชูุงูุฏ ฺฉ **Swarm** ุงุฌุงุฏ ฺฉูุฏ.
ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู **Docker Engine daemon** ุฑู ุชูุงู ูุงุดูโูุง ูุฒุจุงู ุดูุง ุฏุฑ ุญุงู ุงุฌุฑุงุณุช.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ูุงุดู Manager

ฺฉ ุชุฑููุงู ุจุงุฒ ฺฉุฑุฏู ู ุจุง ุงุณุชูุงุฏู ุงุฒ **SSH** ุจู ูุงุดู ฺฉู ูุฑุงุฑ ุงุณุช ููุด **Manager** ุฑุง ุฏุงุดุชู ุจุงุดุฏ ูุตู ุดูุฏ.
ุฏุฑ ุงู ุขููุฒุดุ ูุงุดู **`manager1`** ุจูโุนููุงู Manager ุงุณุชูุงุฏู ูโุดูุฏ.

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ุงุฌุฑุง ุฏุณุชูุฑ ุงุฌุงุฏ Swarm

ุจุฑุง ุงุฌุงุฏ Swarmุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker swarm init --advertise-addr <MANAGER-IP>
```

ุฏุฑ ุงู ูุซุงูุ ุฏุณุชูุฑ ุจู ุงู ุดฺฉู ุงุณุช:

```bash
docker swarm init --advertise-addr 192.168.99.100
```

๐ **ุฎุฑูุฌ ููููู:**

```
Swarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join \
    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
    192.168.99.100:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.
```

๐น **ุชูุถุญ:**
ูพุงุฑุงูุชุฑ `--advertise-addr` ุจุงุนุซ ูโุดูุฏ ููุฏ Manager ุขุฏุฑุณ IP ุฎูุฏุด ุฑุง ุจูโุตูุฑุช `192.168.99.100` ุจู ุจูู ููุฏูุง ุงุนูุงู ฺฉูุฏ. ุณุงุฑ ููุฏูุง ุจุงุฏ ุจุชูุงููุฏ ุจู ุงู IP ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ.

๐น **ฺฉูุฏ ุงููุช (`--token`)**

* ุจุฑุง ุงุถุงูู ฺฉุฑุฏู **Worker** ุง **Manager** ุจู Swarm ุงุณุชูุงุฏู ูโุดูุฏ.
* ููุน ููุฏ ุจุฑ ุงุณุงุณ ุชูฺฉู ุงุณุชูุงุฏู ุดุฏู ูุดุฎุต ูโุดูุฏ.

---

### 3๏ธโฃ ุจุฑุฑุณ ูุถุนุช Swarm

ุจุฑุง ูุดุงูุฏู ูุถุนุช ูุนู Swarm:

```bash
docker info
```

๐ **ุฎุฑูุฌ ููููู:**

```
Swarm: active
  NodeID: dxn1zf6l61qsb1josjja83ngz
  Is Manager: true
  Managers: 1
  Nodes: 1
```

ุงู ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ ฺฉู Swarm ูุนุงู ุงุณุช ู ุงู ููุฏ ููุด **Manager** ุฏุงุฑุฏ.

---

### 4๏ธโฃ ูุดุงูุฏู ูุณุช ููุฏูุง

ุจุฑุง ูุดุงูุฏู ุงุทูุงุนุงุช ููุฏูุง ููุฌูุฏ ุฏุฑ Swarm:

```bash
docker node ls
```

๐ **ุฎุฑูุฌ ููููู:**

```
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
dxn1zf6l61qsb1josjja83ngz *  manager1  Ready   Active        Leader
```

๐น ุนูุงูุช `*` ูุดุงู ูโุฏูุฏ ฺฉู ุดูุง ุฑู ููู ููุฏ ูุชุตู ูุณุชุฏ.
๐น ุณุชูู **MANAGER STATUS** ููุฏุงุฑ **Leader** ุฑุง ูุดุงู ูโุฏูุฏุ ุนู ุงู ููุฏ ููุด ูุฏุฑ Managerูุง ุฑุง ุฏุงุฑุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ุงุฌุงุฏ Swarm ู ููุดโูุง

```mermaid
sequenceDiagram
    participant U as User
    participant M as Manager Node (manager1)
    participant W1 as Worker Node 1
    participant W2 as Worker Node 2

    U->>M: docker swarm init --advertise-addr 192.168.99.100
    M-->>U: Swarm initialized (Manager Token & Worker Token)
    U->>W1: docker swarm join --token <Worker-Token> 192.168.99.100:2377
    U->>W2: docker swarm join --token <Worker-Token> 192.168.99.100:2377
    M->>M: docker node ls (List all nodes)
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ฺฏุงู              | ุชูุถุญ                             | ูฺฉุชู ุงููุช / ุนููุงุช                           |
| ---------------- | --------------------------------- | ----------------------------------------------- |
| ุงุชุตุงู ุจู Manager | SSH ุจู ูุงุดู Manager              | ูุทูุฆู ุดูุฏ ูพูุฑุชโูุง 22 ู Swarm ุจุงุฒ ูุณุชูุฏ        |
| ุงุฌุงุฏ Swarm      | `docker swarm init`               | ุงุณุชูุงุฏู ุงุฒ IP ุซุงุจุช ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุดฺฉูุงุช ุงุชุตุงู |
| ุงุถุงูู ฺฉุฑุฏู ููุฏูุง | ุงุณุชูุงุฏู ุงุฒ ุชูฺฉู Worker ุง Manager | ุชูฺฉูโูุง ุฑุง ุงูู ูฺฏู ุฏุงุฑุฏ                        |
| ุจุฑุฑุณ ูุถุนุช      | `docker info` ู `docker node ls`  | ูุงูุชูุฑูฺฏ ููุฏูุง ุจุนุฏ ุงุฒ Join                    |

---
# Add nodes to the swarm

## ๐ฅ ุงูุฒูุฏู ููุฏูุง ุจู Swarm

ูพุณ ุงุฒ ุงูฺฉู [ฺฉ Swarm ุงุฌุงุฏ ฺฉุฑุฏุฏ](create-swarm.md) ู ฺฉ ููุฏ **Manager** ุฑุงูโุงูุฏุงุฒ ุดุฏุ ูโุชูุงูุฏ ููุฏูุง **Worker** ุฑุง ุจู ุขู ุงุถุงูู ฺฉูุฏ.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Worker ุงูู

ฺฉ ุชุฑููุงู ุจุงุฒ ฺฉุฑุฏู ู ุจุง **SSH** ุจู ูุงุดู ฺฉู ูโุฎูุงูุฏ ููุด **Worker** ุฏุงุดุชู ุจุงุดุฏ ูุตู ุดูุฏ.
ุฏุฑ ุงู ูุซุงูุ ูุงู ุงู ูุงุดู `worker1` ุงุณุช:

```bash
ssh user@worker1
```

---

### 2๏ธโฃ ุงุฌุฑุง ุฏุณุชูุฑ Join ุจุฑุง Worker

ุฏุณุชูุฑ **Join** ุฑุง ุงุฒ ุฎุฑูุฌ `docker swarm init` (ุฑู Manager) ฺฉูพ ฺฉุฑุฏู ู ุฑู Worker ุงุฌุฑุง ฺฉูุฏ:

```bash
docker swarm join \
  --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
  192.168.99.100:2377
```

๐ **ุฎุฑูุฌ ููููุชโุขูุฒ:**

```
This node joined a swarm as a worker.
```

---

#### ๐น ุงฺฏุฑ ุฏุณุชูุฑ Join ุฑุง ฺฏู ฺฉุฑุฏุฏ

ุฑู ฺฉ **Manager Node** ุงู ุฏุณุชูุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ ุชุง ุชูฺฉู ู ุฏุณุชูุฑ Join ุจุฑุง Worker ุฑุง ุจุจูุฏ:

```bash
docker swarm join-token worker
```

ุฎุฑูุฌ ูุดุงุจู:

```
To add a worker to this swarm, run the following command:

    docker swarm join \
    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
    192.168.99.100:2377
```

---

### 3๏ธโฃ ุงุชุตุงู ุจู ููุฏ Worker ุฏูู

ุจู ูุงุดู ุฏูู (`worker2`) SSH ุจุฒูุฏ:

```bash
ssh user@worker2
```

---

### 4๏ธโฃ ุงุฌุฑุง ุฏุณุชูุฑ Join ุจุฑุง Worker ุฏูู

ููุงู ุฏุณุชูุฑ Join ุฑุง ุจุฑุง ุงุชุตุงู Worker ุฏูู ุจู Swarm ุงุฌุฑุง ฺฉูุฏ:

```bash
docker swarm join \
  --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
  192.168.99.100:2377
```

๐ **ุฎุฑูุฌ:**

```
This node joined a swarm as a worker.
```

---

### 5๏ธโฃ ุจุฑุฑุณ ููุฏูุง Swarm ุงุฒ ุฑู Manager

ุจู ููุฏ **Manager** ุจุฑฺฏุฑุฏุฏ ู ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker node ls
```

๐ **ููููู ุฎุฑูุฌ:**

```
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
03g1y59jwfg7cf99w4lt0f662    worker2   Ready   Active
9j68exjopxe7wfl6yuxml7a7j    worker1   Ready   Active
dxn1zf6l61qsb1josjja83ngz *  manager1  Ready   Active        Leader
```

๐น ุณุชูู **MANAGER STATUS** ููุท ุจุฑุง ููุฏูุง Manager ููุฏุงุฑ ุฏุงุฑุฏ.
๐น ููุฏูุง ฺฉู ุฏุฑ ุงู ุณุชูู ููุฏุงุฑ ูุฏุงุฑูุฏุ **Worker** ูุณุชูุฏ.
๐น ุฏุณุชูุฑุงุช ูุฏุฑุช ูุงููุฏ `docker node ls` ููุท ุฑู ููุฏูุง **Manager** ุงุฌุฑุง ูโุดููุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ุงุถุงูู ฺฉุฑุฏู ููุฏูุง Worker

```mermaid
sequenceDiagram
    participant M as Manager Node (manager1)
    participant W1 as Worker Node 1
    participant W2 as Worker Node 2

    M->>M: docker swarm init (Generates Manager & Worker Tokens)
    Note over M: Advertise Address: 192.168.99.100:2377

    W1->>W1: docker swarm join --token <Worker-Token> 192.168.99.100:2377
    W1-->>M: Join request sent
    M-->>W1: Confirm join (Worker role)

    W2->>W2: docker swarm join --token <Worker-Token> 192.168.99.100:2377
    W2-->>M: Join request sent
    M-->>W2: Confirm join (Worker role)

    M->>M: docker node ls (Show all nodes in swarm)
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ ู ุงููุช

| ฺฏุงู         | ุชูุถุญ                            | ูฺฉุชู ุงููุช / ุนููุงุช                                   |
| ----------- | -------------------------------- | ------------------------------------------------------- |
| ุฏุฑุงูุช ุชูฺฉู | `docker swarm join-token worker` | ุชูฺฉูโูุง ุฑุง ุฏุฑ ูุญู ุงูู ุฐุฎุฑู ฺฉูุฏ                        |
| ุงุฌุฑุง Join  | `docker swarm join --token ...`  | IP Manager ุจุงุฏ ุซุงุจุช ู ูุงุจู ุฏุณุชุฑุณ ุจุงุดุฏ                  |
| ุจุฑุฑุณ ููุฏูุง | `docker node ls`                 | ุงู ุฏุณุชูุฑ ููุท ุฑู Manager ุงุฌุฑุง ูโุดูุฏ                   |
| ููุดโูุง      | Worker ููุท ุณุฑูุณ ุงุฌุฑุง ูโฺฉูุฏ     | ุชุบุฑ ููุด ุงุฒ Worker ุจู Manager ุจุง `docker node promote` |


# Deploy a service to the swarm

## ๐ ุงุณุชูุฑุงุฑ ฺฉ ุณุฑูุณ ุฏุฑ Swarm

ูพุณ ุงุฒ ุงูฺฉู [ฺฉ Swarm ุงุฌุงุฏ ฺฉุฑุฏุฏ](create-swarm.md) ู ุฏุฑ ุงู ุขููุฒุด ุญุช [ููุฏูุง Worker ุฑุง ุงุถุงูู ฺฉุฑุฏุฏ](add-nodes.md) (ฺฉู ุงูุฒุงู ูู ูุณุช)ุ ูโุชูุงูุฏ ุณุฑูุณ ุฎูุฏ ุฑุง ุฏุฑ Swarm ูุณุชูุฑ ฺฉูุฏ.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ฺฉ ุชุฑููุงู ุจุงุฒ ฺฉุฑุฏู ู ุจุง **SSH** ุจู ูุงุดู ฺฉู ููุด **Manager** ุฏุงุฑุฏ ูุตู ุดูุฏ.
ุฏุฑ ูุซุงู ุขููุฒุดุ ุงู ูุงุดู ุจุง ูุงู **`manager1`** ุดูุงุฎุชู ูโุดูุฏ:

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ุงุฌุงุฏ ุณุฑูุณ

ุจุฑุง ุณุงุฎุช ฺฉ ุณุฑูุณุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker service create --replicas 1 --name helloworld alpine ping docker.com
```

๐ **ุชูุถุญ ูพุงุฑุงูุชุฑูุง:**

* `docker service create` โ ุงุฌุงุฏ ฺฉ ุณุฑูุณ ุฌุฏุฏ ุฏุฑ Swarm.
* `--name helloworld` โ ูุงู ุณุฑูุณ ุฑุง **helloworld** ุชุนู ูโฺฉูุฏ.
* `--replicas 1` โ ูุถุนุช ูุทููุจ (Desired State) ฺฉ ููููู ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช.
* `alpine ping docker.com` โ ุณุฑูุณ ุจุฑ ุงุณุงุณ ุงูุฌ **Alpine Linux** ุณุงุฎุชู ูโุดูุฏ ู ุฏุณุชูุฑ `ping docker.com` ุฏุฑูู ุขู ุงุฌุฑุง ูโุดูุฏ.

๐ **ููููู ุฎุฑูุฌ:**

```
9uk4639qpg7npwf3fn2aasksr
```

ุงู ุดูุงุณูุ **Service ID** ุดูุงุณุช.

---

### 3๏ธโฃ ูุดุงูุฏู ุณุฑูุณโูุง ุฏุฑ ุญุงู ุงุฌุฑุง

ุจุฑุง ูุณุช ุณุฑูุณโูุง ูุนุงู:

```bash
docker service ls
```

๐ **ููููู ุฎุฑูุฌ:**

```
ID            NAME        SCALE  IMAGE   COMMAND
9uk4639qpg7n  helloworld  1/1    alpine  ping docker.com
```

---

## ๐ ูููุฏุงุฑ Mermaid โ ุฌุฑุงู ุงุณุชูุฑุงุฑ ุณุฑูุณ ุฏุฑ Swarm

```mermaid
sequenceDiagram
    participant U as User (CLI)
    participant M as Manager Node
    participant W as Worker Nodes

    U->>M: docker service create --replicas 1 --name helloworld alpine ping docker.com
    M->>M: ุซุจุช Desired State (1 Replica)
    M->>W: ุชุฎุตุต Task ุงุฌุฑุง ฺฉุงูุชูุฑ
    W-->>M: ฺฏุฒุงุฑุด ูุถุนุช (Running)
    U->>M: docker service ls
    M-->>U: ูุณุช ุณุฑูุณโูุง ู ูุถุนุช Replicaูุง
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ ู ุนููุงุช

| ุจุฎุด                       | ุชูุถุญ                           | ูฺฉุชู ููู                                                |
| ------------------------- | ------------------------------- | ------------------------------------------------------- |
| **Manager Node**          | ูุญู ุงุฌุฑุง ุฏุณุชูุฑุงุช ูุฏุฑุช Swarm | ููุท ุฑู Manager ุงูฺฉุงูโูพุฐุฑ ุงุณุช                          |
| **docker service create** | ุงุฌุงุฏ ุณุฑูุณ                     | ูพุงุฑุงูุชุฑูุง ูุงูุ ููุงุณ ู ุงูุฌ ุถุฑูุฑ ูุณุชูุฏ               |
| **Replicas**              | ุชุนุฏุงุฏ ูููููโูุง ูุนุงู ุณุฑูุณ      | Swarm ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุชุนุฏุงุฏ ุฑุง ุฏุฑ ุญุงูุช ูุทููุจ ูฺฏู ูโุฏุงุฑุฏ |
| **docker service ls**     | ููุงุด ุณุฑูุณโูุง                  | ุดุงูู ูุถุนุช ูุงูุน ุฏุฑ ููุงุจู Desired State                 |

---
# Inspect a service on the swarm

## ๐ ุจุฑุฑุณ ฺฉ ุณุฑูุณ ุฏุฑ Swarm

ูพุณ ุงุฒ ุงูฺฉู [ฺฉ ุณุฑูุณ ุฑุง ุฏุฑ Swarm ูุณุชูุฑ ฺฉุฑุฏุฏ](deploy-service.md)ุ ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ **Docker CLI** ุฌุฒุฆุงุช ูุฑุจูุท ุจู ุขู ุณุฑูุณ ุฑุง ุจุจูุฏ.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ุงฺฏุฑ ูููุฒ ูุชุตู ูุดุฏูโุงุฏุ ุจู ูุงุดู **Manager** ุฎูุฏ ูุงุฑุฏ ุดูุฏ.
ุฏุฑ ุงู ุขููุฒุดุ ูุงุดู **`manager1`** ุงุณุชูุงุฏู ูโุดูุฏ:

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ูุดุงูุฏู ุฌุฒุฆุงุช ุณุฑูุณ ุจูโุตูุฑุช ุฎูุงูุง

ุจุฑุง ุฏุฏู ุฌุฒุฆุงุช ุณุฑูุณ ุฏุฑ ูุงูุจ ุณุงุฏู ู ูุงุจู ุฎูุงูุฏู:

```bash
docker service inspect --pretty <SERVICE-ID>
```

๐ ุจุฑุง ุณุฑูุณ `helloworld`:

```bash
docker service inspect --pretty helloworld
```

๐ **ููููู ุฎุฑูุฌ:**

```
ID:             9uk4639qpg7npwf3fn2aasksr
Name:           helloworld
Service Mode:   REPLICATED
 Replicas:      1
Placement:
UpdateConfig:
 Parallelism:   1
ContainerSpec:
 Image:         alpine
 Args:          ping docker.com
Resources:
Endpoint Mode:  vip
```

๐ก **ูฺฉุชู:**
ุงฺฏุฑ ุจุฎูุงูุฏ ุฎุฑูุฌ ุฑุง ุจู ูุฑูุช **JSON** ุจุจูุฏ (ุจุฑุง ูพุฑุฏุงุฒุด ุง ุงุณุชูุงุฏู ุฏุฑ ุงุณฺฉุฑูพุชโูุง)ุ `--pretty` ุฑุง ุญุฐู ฺฉูุฏ:

```bash
docker service inspect helloworld
```

---

### 3๏ธโฃ ูุดุงูุฏู ููุฏูุง ูุฒุจุงู ุณุฑูุณ

ุจุฑุง ุฏุฏู ุงูฺฉู ฺฉุฏุงู ููุฏูุง ุณุฑูุณ ุฑุง ุงุฌุฑุง ูโฺฉููุฏ:

```bash
docker service ps <SERVICE-ID>
```

๐ ุจุฑุง ูุซุงู:

```bash
docker service ps helloworld
```

๐ **ููููู ุฎุฑูุฌ:**

```
NAME                                    IMAGE   NODE     DESIRED STATE  CURRENT STATE           ERROR  PORTS
helloworld.1.8p1vev3fq5zm0mi8g0as41w35  alpine  worker2  Running        Running 3 minutes
```

๐น ุฏุฑ ุงู ูุซุงูุ ุชููุง Replica ุณุฑูุณ `helloworld` ุฑู **`worker2`** ุฏุฑ ุญุงู ุงุฌุฑุงุณุช.
๐น ุจูโุทูุฑ ูพุดโูุฑุถุ **Manager Node** ูุฒ ูโุชูุงูุฏ ูุงููุฏ Worker ุณุฑูุณ ุงุฌุฑุง ฺฉูุฏ.

---

### 4๏ธโฃ ูุดุงูุฏู ุฌุฒุฆุงุช ฺฉุงูุชูุฑ ุณุฑูุณ

ุฑู ููุฏ ฺฉู Task ุฏุฑ ุขู ุงุฌุฑุง ูโุดูุฏุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุจุฒูุฏ:

```bash
docker ps
```

๐ ุงฺฏุฑ ุณุฑูุณ ุฑู ููุฏ ุฏฺฏุฑ ุงุฌุฑุง ูโุดูุฏุ ุจุงุฏ ุจู ุขู ููุฏ SSH ฺฉูุฏ.
ุจุฑุง ูุซุงูุ ุฑู `worker2`:

```bash
ssh user@worker2
docker ps
```

๐ **ููููู ุฎุฑูุฌ:**

```
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
e609dde94e47        alpine:latest       "ping docker.com"   3 minutes ago       Up 3 minutes                            helloworld.1.8p1vev3fq5zm0mi8g0as41w35
```

---

## ๐ ูููุฏุงุฑ Mermaid โ ุฌุฑุงู ุจุฑุฑุณ ุณุฑูุณ ุฏุฑ Swarm

```mermaid
sequenceDiagram
    participant U as User (CLI)
    participant M as Manager Node
    participant W as Worker Node

    U->>M: docker service inspect --pretty helloworld
    M-->>U: ููุงุด ุฌุฒุฆุงุช ุณุฑูุณ (Readable Format)

    U->>M: docker service ps helloworld
    M-->>U: ููุงุด ููุฏ ูุฒุจุงู ุณุฑูุณ

    alt ุณุฑูุณ ุฑู Worker
        U->>W: ssh ุจู Worker
        W->>W: docker ps
        W-->>U: ููุงุด ุฌุฒุฆุงุช ฺฉุงูุชูุฑ
    else ุณุฑูุณ ุฑู Manager
        M->>M: docker ps
        M-->>U: ููุงุด ุฌุฒุฆุงุช ฺฉุงูุชูุฑ
    end
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ุฏุณุชูุฑ                             | ฺฉุงุฑุจุฑุฏ                    | ูฺฉุชู ููู                                      |
| --------------------------------- | ------------------------- | --------------------------------------------- |
| `docker service inspect --pretty` | ููุงุด ุฎูุงูุง ูุดุฎุตุงุช ุณุฑูุณ | ููุงุณุจ ูุงูุชูุฑูฺฏ ุฏุณุช                         |
| `docker service inspect`          | ููุงุด JSON ูุดุฎุตุงุช ุณุฑูุณ   | ููุงุณุจ ูพุฑุฏุงุฒุด ุฎูุฏฺฉุงุฑ ู ุงุณฺฉุฑูพุชโูุง              |
| `docker service ps`               | ููุงุด ูุญู ุงุฌุฑุง Replicaูุง | ุจุฑุฑุณ ููุงููฺฏ Desired State ู Current State   |
| `docker ps`                       | ููุงุด ุฌุฒุฆุงุช ฺฉุงูุชูุฑ      | ุจุงุฏ ุฑู ููุงู ููุฏ ุงุฌุฑุง ุดูุฏ ฺฉู Task ุฏุฑ ุขู ุงุณุช |

---

# Scale the service in the swarm

## ๐ ููุงุณโุฏู (Scaling) ุณุฑูุณ ุฏุฑ Swarm

ููุช ฺฉ [ุณุฑูุณ ุฑุง ุฏุฑ Swarm ูุณุชูุฑ ฺฉุฑุฏุฏ](deploy-service.md)ุ ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ **Docker CLI** ุชุนุฏุงุฏ ฺฉุงูุชูุฑูุง ุขู ุณุฑูุณ ุฑุง ุชุบุฑ ุฏูุฏ.
ุฏุฑ ูุนูุงุฑ Swarmุ **ูุฑ ฺฉุงูุชูุฑ ฺฉ Task ูุญุณูุจ ูโุดูุฏ**.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ุงฺฏุฑ ูููุฒ ูุชุตู ูุดุฏูโุงุฏุ ุจู ููุฏ **Manager** ูุงุฑุฏ ุดูุฏ.
ุฏุฑ ูุซุงู ุขููุฒุดุ ุงู ูุงุดู ุจุง ูุงู **`manager1`** ุงุณุชูุงุฏู ูโุดูุฏ:

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ุชุบุฑ ูุถุนุช ูุทููุจ (Desired State) ุณุฑูุณ

ุจุฑุง ุชุบุฑ ุชุนุฏุงุฏ Replicaูุง (Tasks)ุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker service scale <SERVICE-ID>=<NUMBER-OF-TASKS>
```

๐ ูุซุงู:
ุจุฑุง ุงูุฒุงุด ุณุฑูุณ `helloworld` ุงุฒ **ฑ** ุจู **ต Replica**:

```bash
docker service scale helloworld=5
```

๐ **ุฎุฑูุฌ:**

```
helloworld scaled to 5
```

---

### 3๏ธโฃ ูุดุงูุฏู ูุณุช Tasks ุจูโุฑูุฒุดุฏู

ุจุฑุง ุฏุฏู ูุญู ุงุฌุฑุง Replicaูุง:

```bash
docker service ps helloworld
```

๐ **ููููู ุฎุฑูุฌ:**

```
NAME                                    IMAGE   NODE      DESIRED STATE  CURRENT STATE
helloworld.1.8p1vev3fq5zm0mi8g0as41w35  alpine  worker2   Running        Running 7 minutes
helloworld.2.c7a7tcdq5s0uk3qr88mf8xco6  alpine  worker1   Running        Running 24 seconds
helloworld.3.6crl09vdcalvtfehfh69ogfb1  alpine  worker1   Running        Running 24 seconds
helloworld.4.auky6trawmdlcne8ad8phb0f1  alpine  manager1  Running        Running 24 seconds
helloworld.5.ba19kca06l18zujfwxyc5lkyn  alpine  worker2   Running        Running 24 seconds
```

๐น Swarm ุจุฑุง ุฑุณุฏู ุจู ต Replicaุ **ด Task ุฌุฏุฏ** ุงุฌุงุฏ ฺฉุฑุฏู ุงุณุช.
๐น ุงู Tasks ุจู ณ ููุฏ Swarm ุชูุฒุน ุดุฏูโุงูุฏ (ุญุช Manager ูู ฺฉ Task ุงุฌุฑุง ูโฺฉูุฏ).

---

### 4๏ธโฃ ุจุฑุฑุณ ฺฉุงูุชูุฑูุง ฺฉ ููุฏ ุฎุงุต

ุจุฑุง ุฏุฏู ฺฉุงูุชูุฑูุง ุฏุฑ ุญุงู ุงุฌุฑุง ุฑู ููุฏ ฺฉู ุจู ุขู ูุชุตู ูุณุชุฏ:

```bash
docker ps
```

๐ ุฑู `manager1`:

```
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
528d68040f95        alpine:latest       "ping docker.com"   About a minute ago   Up About a minute                       helloworld.4.auky6trawmdlcne8ad8phb0f1
```

ุงฺฏุฑ ูโุฎูุงูุฏ ฺฉุงูุชูุฑูุง ููุฏูุง ุฏฺฏุฑ ุฑุง ุจุจูุฏุ ุจุง **SSH** ุจู ุขูโูุง ูุตู ุดูุฏ ู ููุงู ุฏุณุชูุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ุฌุฑุงู Scaling ุณุฑูุณ ุฏุฑ Swarm

```mermaid
sequenceDiagram
    participant U as User (CLI)
    participant M as Manager Node
    participant W1 as Worker 1
    participant W2 as Worker 2

    U->>M: docker service scale helloworld=5
    M->>M: ุชุบุฑ Desired State ุจู 5
    M->>W1: ุชุฎุตุต Taskูุง ุฌุฏุฏ
    M->>W2: ุชุฎุตุต Taskูุง ุฌุฏุฏ
    M->>M: ุงุฌุฑุง Task ุฏุฑ Manager (ุฏุฑ ุตูุฑุช ูุงุฒ)
    U->>M: docker service ps helloworld
    M-->>U: ููุงุด ูุณุช Replicaูุง ู ูุญู ุงุฌุฑุง ุขูโูุง
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ุฏุณุชูุฑ                  | ฺฉุงุฑุจุฑุฏ                     | ูฺฉุชู ููู                                       |
| ---------------------- | -------------------------- | ---------------------------------------------- |
| `docker service scale` | ุชุบุฑ ุชุนุฏุงุฏ Replicaูุง      | ููุท ุฑู Manager ุงุฌุฑุง ูโุดูุฏ                    |
| `docker service ps`    | ููุงุด ูุณุช Tasks           | ูุถุนุช **Desired** ู **Current** ุฑุง ููุงุณู ฺฉูุฏ |
| `docker ps`            | ููุงุด ฺฉุงูุชูุฑูุง ุฑู ฺฉ ููุฏ | ุจุงุฏ ุฑู ููุงู ููุฏ ุงุฌุฑุง ุดูุฏ                     |

---

# Delete the service running on the swarm

## ๐ ุญุฐู ุณุฑูุณ ุฏุฑ Swarm

ุงฺฉููู ฺฉู ูุฑุงุญู ุขููุฒุด ุจุง ุณุฑูุณ `helloworld` ุจู ูพุงุงู ุฑุณุฏูุ ูโุชูุงูู ุขู ุฑุง ุงุฒ Swarm ุญุฐู ฺฉูู.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ุงฺฏุฑ ูููุฒ ูุชุตู ูุดุฏูโุงุฏุ ุจู ููุฏ **Manager** ูุงุฑุฏ ุดูุฏ.
ุฏุฑ ูุซุงู ุขููุฒุดุ ุงู ูุงุดู ุจุง ูุงู **`manager1`** ุงุณุชูุงุฏู ูโุดูุฏ:

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ุงุฌุฑุง ุฏุณุชูุฑ ุญุฐู ุณุฑูุณ

ุจุฑุง ุญุฐู ุณุฑูุณ `helloworld`:

```bash
docker service rm helloworld
```

๐ **ููููู ุฎุฑูุฌ:**

```
helloworld
```

---

### 3๏ธโฃ ุงุทููุงู ุงุฒ ุญุฐู ุณุฑูุณ

ุจุฑุง ุจุฑุฑุณ ุงูฺฉู ุณุฑูุณ ูุงูุนุงู ุญุฐู ุดุฏู ุงุณุช:

```bash
docker service inspect helloworld
```

๐ **ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:**

```
[]
Status: Error: no such service: helloworld, Code: 1
```

ุงู ูพุงู ูุดุงู ูโุฏูุฏ ฺฉู ุณุฑูุณ ุฏฺฏุฑ ุฏุฑ Swarm ูุฌูุฏ ูุฏุงุฑุฏ.

---

### 4๏ธโฃ ุจุฑุฑุณ ูพุงฺฉ ุดุฏู ฺฉุงูุชูุฑูุง

ูุฑฺูุฏ ุณุฑูุณ ุญุฐู ุดุฏูุ ููฺฉู ุงุณุช **Task Containerูุง** ฺูุฏ ุซุงูู ุทูู ุจฺฉุดูุฏ ุชุง ุจูโุทูุฑ ฺฉุงูู ูพุงฺฉ ุดููุฏ.
ุจุฑุง ุจุฑุฑุณ ุฑู ููุฏูุง:

```bash
docker ps
```

๐ ููฺฉู ุงุณุช ุงุจุชุฏุง ุงู ูุถุนุช ุฑุง ุจุจูุฏ:

```
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS   NAMES
db1651f50347        alpine:latest       "ping docker.com"   44 minutes ago      Up 46 seconds       ...     helloworld.5....
43bf6e532a92        alpine:latest       "ping docker.com"   44 minutes ago      Up 46 seconds       ...     helloworld.3....
...
```

ฺูุฏ ูุญุธู ุจุนุฏ ุฏูุจุงุฑู ุงุฌุฑุง ฺฉูุฏ:

```
CONTAINER ID   IMAGE   COMMAND   CREATED   STATUS   PORTS   NAMES
```

ูุณุช ุฎุงู ูุดุงู ูโุฏูุฏ ฺฉู ฺฉุงูุชูุฑูุง ูู ูพุงฺฉ ุดุฏูโุงูุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ุฌุฑุงู ุญุฐู ุณุฑูุณ ุฏุฑ Swarm

```mermaid
sequenceDiagram
    participant U as User (CLI)
    participant M as Manager Node
    participant N as Worker/Manager Nodes

    U->>M: docker service rm helloworld
    M->>M: ุญุฐู ุณุฑูุณ ุงุฒ Swarm Manager
    M->>N: ุงุฑุณุงู ุฏุณุชูุฑ ุชููู ู ุญุฐู Tasks
    N-->>M: ุชุงุฏ ุญุฐู Tasks
    U->>M: docker service inspect helloworld
    M-->>U: Error: no such service
    U->>N: docker ps
    N-->>U: ูุณุช ุฎุงู (ฺฉุงูุชูุฑูุง ุญุฐู ุดุฏูุฏ)
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ุฏุณุชูุฑ                      | ฺฉุงุฑุจุฑุฏ                  | ูฺฉุชู ููู                             |
| -------------------------- | ----------------------- | ------------------------------------ |
| `docker service rm <name>` | ุญุฐู ุณุฑูุณ ุงุฒ Swarm      | ููุท ุฑู Manager ุงุฌุฑุง ูโุดูุฏ          |
| `docker service inspect`   | ุจุฑุฑุณ ูุถุนุช ุณุฑูุณ       | ุฎุทุง `no such service` ุนู ุญุฐู ูููู |
| `docker ps`                | ุจุฑุฑุณ ูพุงฺฉ ุดุฏู ฺฉุงูุชูุฑูุง | ููฺฉู ุงุณุช ฺูุฏ ุซุงูู ุฒูุงู ุจุจุฑุฏ         |

# Apply rolling updates to a service


## ๐ ุงุฌุฑุง Rolling Update ุฑู ุณุฑูุณ ุฏุฑ Swarm

ุฏุฑ ูุฑุงุญู ูุจูุ ุดูุง ฺฉ ุณุฑูุณ ุฑุง [ููุงุณโุฏู ฺฉุฑุฏุฏ](scale-service.md).
ุฏุฑ ุงู ุจุฎุดุ ุงุจุชุฏุง ฺฉ ุณุฑูุณ ุจุฑ ุงุณุงุณ ุงูุฌ `redis:7.4.0` ูุณุชูุฑ ูโฺฉูู ู ุณูพุณ ุขู ุฑุง ุจู ูุณุฎู `redis:7.4.1` ุงุฑุชูุง ูโุฏููุ ุจูโุทูุฑโฺฉู ุจุฑูุฒุฑุณุงู ุจู ุตูุฑุช ูุฑุญููโุง (Rolling) ู ุจุง ุชุฃุฎุฑ ูุดุฎุต ุจู ูุฑ Replica ุงูุฌุงู ุดูุฏ.

---

### 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ุงฺฏุฑ ูููุฒ ูุชุตู ูุดุฏูโุงุฏุ ุจู ูุงุดู **Manager** ูุตู ุดูุฏ.
ุฏุฑ ูุซุงู ุขููุฒุดุ ุงู ูุงุดู **`manager1`** ุงุณุช:

```bash
ssh user@manager1
```

---

### 2๏ธโฃ ุงุณุชูุฑุงุฑ ุณุฑูุณ Redis ุจุง ุณุงุณุช Rolling Update

ุจุฑุง ุงุฌุงุฏ ุณุฑูุณ Redis ุจุง ณ Replica ู ุชุฃุฎุฑ ฑฐ ุซุงูู ุจู ูุฑ ุจุฑูุฒุฑุณุงู:

```bash
docker service create \
  --replicas 3 \
  --name redis \
  --update-delay 10s \
  redis:7.4.0
```

๐ **ุชูุถุญ ูพุงุฑุงูุชุฑูุง:**

* `--replicas 3` โ ุชุนุฏุงุฏ Replicaูุง.
* `--update-delay 10s` โ ูุงุตูู ุฒูุงู ุจู ุจุฑูุฒุฑุณุงู ูุฑ Task.
* ูโุชูุงูุฏ ุฒูุงู ุฑุง ุชุฑฺฉุจ ูุงุฑุฏ ฺฉูุฏ (ูุซูุงู `10m30s`).
* `--update-parallelism` โ ุชุนุฏุงุฏ Taskูุง ฺฉู ููุฒูุงู ุจุฑูุฒุฑุณุงู ูโุดููุฏ (ูพุดโูุฑุถ 1).
* `--update-failure-action` โ ูุดุฎุต ูโฺฉูุฏ ุฏุฑ ุตูุฑุช ุดฺฉุณุช ุจุฑูุฒุฑุณุงู ฺู ุงุชูุงู ุจูุชุฏ (`pause`ุ `continue` ุง `rollback`).

---

### 3๏ธโฃ ุจุฑุฑุณ ุณุฑูุณ

ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุช ุณุฑูุณ:

```bash
docker service inspect --pretty redis
```

๐ ุฎุฑูุฌ ููููู:

```
Name:           redis
Replicas:       3
UpdateConfig:
 Parallelism:   1
 Delay:         10s
ContainerSpec:
 Image:         redis:7.4.0
```

---

### 4๏ธโฃ ุจูโุฑูุฒุฑุณุงู Rolling ุจู ูุณุฎู ุฌุฏุฏ

ุจุฑุง ุงุฑุชูุงุก ุจู ูุณุฎู `redis:7.4.1`:

```bash
docker service update --image redis:7.4.1 redis
```

๐ ุฑููุฏ ูพุดโูุฑุถ Scheduler:

1. ุชููู ุงููู Task.
2. ุฑุงูโุงูุฏุงุฒ Task ุจุง ูุณุฎู ุฌุฏุฏ.
3. ุงฺฏุฑ Task ุจู ุญุงูุช RUNNING ุฑูุชุ ุจุนุฏ ุงุฒ Delay ูุดุฎุต ุจู ุณุฑุงุบ Task ุจุนุฏ ูโุฑูุฏ.
4. ุงฺฏุฑ Task ุจู ุญุงูุช FAILED ุฑูุชุ ุจุฑูุฒุฑุณุงู ูุชููู ูโุดูุฏ.

---

### 5๏ธโฃ ุจุฑุฑุณ ูุณุฎู ุฌุฏุฏ ุฏุฑ Desired State

```bash
docker service inspect --pretty redis
```

๐ ุฎุฑูุฌ ูพุณ ุงุฒ ุจุฑูุฒุฑุณุงู ูููู:

```
Image:         redis:7.4.1
```

๐ ุงฺฏุฑ ุจุฑูุฒุฑุณุงู ูุชููู ุดูุฏ:

```
Update status:
 State:    paused
 Message:  update paused due to failure...
```

ุจุฑุง ุงุฏุงูู ุจุฑูุฒุฑุณุงู:

```bash
docker service update redis
```

---

### 6๏ธโฃ ูุดุงูุฏู ูุฑุขูุฏ Rolling Update

```bash
docker service ps redis
```

๐ ููููู ุฎุฑูุฌ:

```
redis.1   redis:7.4.1  worker1   Running
 \_ redis.1  redis:7.4.0  worker2   Shutdown
redis.2   redis:7.4.1  worker2   Running
 \_ redis.2  redis:7.4.0  worker1   Shutdown
redis.3   redis:7.4.1  worker1   Running
 \_ redis.3  redis:7.4.0  manager1  Shutdown
```

๐น ุชุง ูุจู ุงุฒ ุงุชูุงู ุจุฑูุฒุฑุณุงูุ ุจุนุถ Replicaูุง ูุณุฎู ูุฏู ู ุจุฑุฎ ูุณุฎู ุฌุฏุฏ ุฑุง ุงุฌุฑุง ูโฺฉููุฏ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ุฌุฑุงู Rolling Update

```mermaid
sequenceDiagram
    participant U as User (CLI)
    participant M as Manager Node
    participant N1 as Node 1
    participant N2 as Node 2
    participant N3 as Node 3

    U->>M: docker service update --image redis:7.4.1 redis
    M->>N1: Stop Task (redis:7.4.0) & Start redis:7.4.1
    Note over M: Wait 10s (Update Delay)
    M->>N2: Stop Task (redis:7.4.0) & Start redis:7.4.1
    Note over M: Wait 10s
    M->>N3: Stop Task (redis:7.4.0) & Start redis:7.4.1
    M-->>U: Rolling Update Complete
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ฺฏุฒูู                     | ุชูุถุญ                                      | ูุซุงู                            |
| ------------------------- | ------------------------------------------ | ------------------------------- |
| `--update-delay`          | ุฒูุงู ุจู ุจุฑูุฒุฑุณุงู Taskูุง                  | `10s` ุง `1m30s`                |
| `--update-parallelism`    | ุชุนุฏุงุฏ Taskูุง ฺฉู ููุฒูุงู ุจุฑูุฒุฑุณุงู ูโุดููุฏ | `--update-parallelism 2`        |
| `--update-failure-action` | ุฑูุชุงุฑ ุฏุฑ ุดฺฉุณุช ุจุฑูุฒุฑุณุงู                    | `pause`, `continue`, `rollback` |
| `docker service ps`       | ูุดุงูุฏู ูุถุนุช ูุฑ Replica                    | ุจุฑุฑุณ ุชูุงูุช ูุณุฎู ูุฏู ู ุฌุฏุฏ    |


# Drain a node on the swarm

## ๐ ูุฑุงุฑ ุฏุงุฏู ฺฉ ููุฏ ุฏุฑ ุญุงูุช Drain ุฏุฑ Swarm

ุฏุฑ ูุฑุงุญู ูุจูุ ููู ููุฏูุง ุดูุง ุฏุฑ ูุถุนุช **Active** ุจูุฏูุฏ.
ููุช ฺฉ ููุฏ **Active** ุงุณุชุ Swarm Manager ูโุชูุงูุฏ ุจู ุขู Task ุงุฎุชุตุงุต ุฏูุฏ.
ุงูุง ฺฏุงู (ูุซู ุฒูุงูโูุง ุชุนูุฑุงุช ุง ูฺฏูุฏุงุฑ) ูุงุฒู ุงุณุช ููุฏ ุฑุง ุฏุฑ ูุถุนุช **Drain** ูุฑุงุฑ ุฏูุฏ.

ุญุงูุช **Drain** ุจุงุนุซ ูโุดูุฏ:

* ููุฏ ูฺ Task ุฌุฏุฏ ุงุฒ ุณุฑูุณโูุง Swarm ุฏุฑุงูุช ูฺฉูุฏ.
* Taskูุง ูุนู ุฑู ุขู ูุชููู ุดููุฏ ู ุฑู ููุฏูุง Active ุฏฺฏุฑ ุงุฌุฑุง ุดููุฏ.

> โ๏ธ **ููู:**
> ุญุงูุช Drain ููุท ุฑู **Taskูุง ุณุฑูุณโูุง Swarm** ุงุซุฑ ุฏุงุฑุฏ.
> ฺฉุงูุชูุฑูุง ูุณุชูู (ุงุฌุงุฏ ุดุฏู ุจุง `docker run`ุ `docker compose up` ุง API) ุญุฐู ุง ูุชููู ููโุดููุฏ.

---

## 1๏ธโฃ ุงุชุตุงู ุจู ููุฏ Manager

ุงฺฏุฑ ูููุฒ ุจู ููุฏ Manager ูุชุตู ูุณุชุฏุ ูุงุฑุฏ ุดูุฏ.
ุฏุฑ ุงู ุขููุฒุดุ ููุฏ Manager ุจุง ูุงู **`manager1`** ุงุณุช:

```bash
ssh ฺฉุงุฑุจุฑ@manager1
```

---

## 2๏ธโฃ ุจุฑุฑุณ ูุถุนุช ูุนู ููู ููุฏูุง

ุจุฑุง ุฏุฏู ูุถุนุช ููู ููุฏูุง:

```bash
docker node ls
```

ููููู ุฎุฑูุฌ:

```
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
1bcef6utixb0l0ca7gxuivsj0    worker2   Ready   Active
38ciaotwjuritcdtn9npbnkuz    worker1   Ready   Active
e216jshn25ckzbvmwlnh5jr3g *  manager1  Ready   Active        Leader
```

> ููู ููุฏูุง ุฏุฑ ุญุงูุช Active ูุณุชูุฏ.

---

## 3๏ธโฃ ุงุฌุฑุง ุณุฑูุณ Redis (ุฏุฑ ุตูุฑุช ุงุฌุฑุง ูุดุฏู ูุจู)

ุงฺฏุฑ ุณุฑูุณ Redis ุงุฒ ูุฑุญูู [Rolling Update](rolling-update.md) ูููุฒ ูุนุงู ูุณุชุ ุขู ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker service create --replicas 3 --name redis --update-delay 10s redis:7.4.0
```

ููููู ุฎุฑูุฌ:

```
c5uo6kdmzpon37mgj9mwglcfw
```

---

## 4๏ธโฃ ูุดุงูุฏู ุชูุฒุน Taskูุง

ุจุฑุง ุฏุฏู ุงูฺฉู Taskูุง ุณุฑูุณ ุจู ฺู ููุฏูุง ุชูุฒุน ุดุฏูโุงูุฏ:

```bash
docker service ps redis
```

ููููู ุฎุฑูุฌ:

```
NAME                               IMAGE        NODE     DESIRED STATE  CURRENT STATE
redis.1.7q92v0nr1hcgts2amcjyqg3pq  redis:7.4.0  manager1 Running        Running 26 seconds
redis.2.7h2l8h3q3wqy5f66hlv9ddmi6  redis:7.4.0  worker1  Running        Running 26 seconds
redis.3.9bg7cezvedmkgg6c8yzvbhwsd  redis:7.4.0  worker2  Running        Running 26 seconds
```

> ุงูุฌุง ูุฑ ููุฏ ฺฉ Task ุฏุฑุงูุช ฺฉุฑุฏู ุงุณุช.

---

## 5๏ธโฃ ุชุบุฑ ูุถุนุช ฺฉ ููุฏ ุจู Drain

ุจุฑุง ูุฑุงุฑ ุฏุงุฏู `worker1` ุฏุฑ ุญุงูุช Drain:

```bash
docker node update --availability drain worker1
```

ููููู ุฎุฑูุฌ:

```
worker1
```

---

## 6๏ธโฃ ุจุฑุฑุณ ูุถุนุช ููุฏ Drain ุดุฏู

ุจุฑุง ุฏุฏู ุฌุฒุฆุงุช:

```bash
docker node inspect --pretty worker1
```

ููููู ุฎุฑูุฌ:

```
ID:                  38ciaotwjuritcdtn9npbnkuz
Hostname:            worker1
Status:
 State:              Ready
 Availability:       Drain
...ุจุฎุดโูุง ุฏฺฏุฑ...
```

> ุญุงูุง Availability ุจุฑุงุจุฑ Drain ุงุณุช.

---

## 7๏ธโฃ ูุดุงูุฏู ุฌุงุจูโุฌุง Taskูุง

ููุช ฺฉ ููุฏ Drain ุดูุฏุ Swarm Taskูุง ุขู ุฑุง ุฑู ููุฏูุง Active ุงุฌุฑุง ูโฺฉูุฏ.

```bash
docker service ps redis
```

ููููู ุฎุฑูุฌ:

```
NAME                                    IMAGE        NODE      DESIRED STATE  CURRENT STATE           ERROR
redis.1.7q92v0nr1hcgts2amcjyqg3pq       redis:7.4.0  manager1  Running        Running 4 minutes
redis.2.b4hovzed7id8irg1to42egue8       redis:7.4.0  worker2   Running        Running About a minute
 \_ redis.2.7h2l8h3q3wqy5f66hlv9ddmi6   redis:7.4.0  worker1   Shutdown       Shutdown 2 minutes ago
redis.3.9bg7cezvedmkgg6c8yzvbhwsd       redis:7.4.0  worker2   Running        Running 4 minutes
```

> Task ุดูุงุฑู 2 ฺฉู ูุจูุงู ุฑู worker1 ุจูุฏุ ุฑู worker2 ุฑุงูโุงูุฏุงุฒ ุดุฏู ุงุณุช.

---

## 8๏ธโฃ ุจุงุฒฺฏุฑุฏุงูุฏู ููุฏ ุจู ุญุงูุช Active

ุจุฑุง ูุนุงูโุณุงุฒ ุฏูุจุงุฑู worker1:

```bash
docker node update --availability active worker1
```

ููููู ุฎุฑูุฌ:

```
worker1
```

---

## 9๏ธโฃ ุจุฑุฑุณ ุชุบุฑ ูุถุนุช

```bash
docker node inspect --pretty worker1
```

ููููู ุฎุฑูุฌ:

```
ID:                  38ciaotwjuritcdtn9npbnkuz
Hostname:            worker1
Status:
 State:              Ready
 Availability:       Active
...ุจุฎุดโูุง ุฏฺฏุฑ...
```

> ุญุงูุง worker1 ุฏูุจุงุฑู ูโุชูุงูุฏ Taskูุง ุฌุฏุฏ ุจฺฏุฑุฏุ ฺู ุฏุฑ ููุงุณโฺฏุฐุงุฑุ ฺู Rolling Update ู ฺู ุฏุฑ ุฌุงฺฏุฒู Taskูุง ุฎุฑุงุจ.

---

## ๐ ูููุฏุงุฑ Mermaid โ ูุฑุขูุฏ Drain ู Active

```mermaid
sequenceDiagram
    participant U as ฺฉุงุฑุจุฑ (CLI)
    participant M as Manager Node
    participant W1 as Worker1
    participant W2 as Worker2

    U->>M: docker node update --availability drain worker1
    M->>W1: ุชููู Taskูุง Swarm
    M->>W2: ุงุฌุฑุง Taskูุง ุฌุงฺฏุฒู
    U->>M: docker node inspect --pretty worker1
    M-->>U: ููุงุด ูุถุนุช Drain
    U->>M: docker node update --availability active worker1
    M-->>U: worker1 ุจู Active ุจุฑฺฏุดุช
```

---

## ๐ฏ ูฺฉุงุช ฺฉูุฏ

| ุฏุณุชูุฑ                                      | ฺฉุงุฑุจุฑุฏ                            | ูฺฉุชู ููู                                    |
| ------------------------------------------ | --------------------------------- | ------------------------------------------- |
| `docker node update --availability drain`  | ุบุฑูุนุงู ฺฉุฑุฏู ููุฏ ุจุฑุง ุฏุฑุงูุช Task | ููุท Taskูุง ุณุฑูุณโูุง Swarm ุฌุงุจูโุฌุง ูโุดููุฏ |
| `docker node inspect --pretty`             | ุจุฑุฑุณ ูุถุนุช ููุฏ                   | Availability ุจุงุฏ Drain ุง Active ุจุงุดุฏ      |
| `docker node update --availability active` | ูุนุงูโุณุงุฒ ูุฌุฏุฏ ููุฏ                | ุจุนุฏ ุงุฒ ูุนุงูโุณุงุฒุ ููุฏ ุขูุงุฏู ุฏุฑุงูุช Task ุงุณุช |
